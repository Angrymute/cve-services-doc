# User Registry


## Registry Requirements

### Contain a collection of organizations with desired details about each
> Serves as a type of yellow pages for organizations
- Details can be found by short name or UUID
- Organization can change names & short name, UUID stays the same if they're considered the same organization
- List of possible details:
	- Public POC: email, phone number, IM servers/domains, company forms
	- Public key for encrypted email
	- Notification email for system/service email notifications
	- Scope statement
	- Roles (CNA, ADP, CNA of Last Resort, Root CNA, Secretariat)
	- Sensitive data sets:
		- Operational Contact -> non-public channel
			- Separate operational contact blocks for each role the org fills: ADP, CNA, Root, CNA of LR
			- Not mandatory, it is voluntary.
			! Who can see this? Can all users see this? Can everyone in the User Registry see it?
		- Administration Contact -> Secretariat, Roots, and ==Board==
			- Mandatory set of information to be a part of User Registry, used for urgent communication between Sec, Root, Board communication to the Org.
Should there be fields like the CVE program lead for that organization?
> Possibly multiple program leads for the CNA part of the org, ADP part of org, possibly CNA of LR program lead.
Basically a staff listing for the CNA?
- Full text search on fields like Name, Scope Statement
- After MVP: Key Value pair of URL names to URLs for the CNA's disclosure statements, tag definitions, etc.
- Ability to allow website to display the Org's tree (who their Root is, Subordinate CNAs)

### Contain a collection of Users with data necessary for them to function within the system.
- At an absolute minimum: UUID, username, organization, role, API secret, and email. Optional is name for accounts for people.
- Only Admins (and Secretariat IT Admins) are able to see users.
- Details that qualify under GDPR/PII need to be removable without negatively affecting CVEs the User touched
	- UUID stays, identifying details disappear
	- GDPR/PII: names, username, emails, API secret
- Secretariat will need to be able to revoke data and have that revocation iterate through history tracking so the PII no longer exists.
> Note: upon creation of account or registration of CNA, an agreement must be made to not post PII unless approved by that individual


## Authentication Requirements

### Be capable of authenticating a request to the services
> Services will give the User Registry the CNA short name, username, and API secret provided in the request. User Registry will confirm all are valid.
> With validation, User Registry will return the authoritative role(s) the User has to assist services in understanding what the User is allowed to do within the system.

### Link Users in the User Registry to their record in the Cognito User Pool
> So the CVE website can use Cognito to authenticate Users, keep their session, and track their authorization (kept in the User Registry) throughout the session.
> Also plan to use said service to store Users' API secret for added safety.
> User Registry will need to understand Cognito tokens in order to confirm authentication when Users are acting through the website.
! Enable 2FA?  If so, SMS, Time-based token?  Or user chooses?
	- Need to have discussion in AWG. Is MFA absolutely necessary for stage 1? If so, why?
! What social logins are we seeking to support initially?
	- If we can integrate with GitHub, would be preferable.


## Entity Policy Requirements

### Host policy data for CNAs
> For now, the only policy to host is an ID quota.
> User Registry will provide an endpoint where the IDA can attempt to update the amount of allocated IDs for a CNA. If that would go above the policy, the User Registry fails the request, returns an error message to assist IDA in informing the client what their quota is, and how many IDs they can currently allocate without going over that quota.
> In the future, the User Registry can hold other data values and implement endpoints to answer additional policy questions.

## Usage Metrics
?

## Entity Role Requirements

### Entities can hold more than one role
> An org can have CNA status and ADP status. Either can be revoked.
> Secretariat and CNA || Root CNA
> ! TO BE CONTINUED
> Root CNA and CNA and/or ADP

### A "global" ADP role
Allows users of the ADP to contribute ADP container data to CVEs. Global indicates it is managed by the Top Root and therefore has scope on all CVEs.
> In the future, ADPs can be under other Roots (not global) and therefore their scope is limited to CVEs maintained by that Root's Sub-CNAs.

### Secretariat can register CNAs and Users

### Conversely, the Secretariat can deactivate all CNAs and Users

### Root CNAs can register Sub-CNAs and Users for that Sub-CNA
! Can a Root CNA revoke a Sub-CNA User account?
	- Can they revoke **any** account for that CNA? (Admin roles)
! Can a Root CNA revoke a whole Sub-CNA?
	- How does this resolve?
		- Who becomes the maintainer of that CNA's CVEs?
		- What happens to all the users?

### Root CNAs can have Root CNAs (I.E. Root CNAs can register a Sub-CNA as a Root CNA)
How deep does this go? What does this structure look like?
! Can a higher Root revoke a lower Root's Root status?
	- How does this resolve?
	- Where do the lower Root's Sub-CNAs go?
	- What happens to that Root's Root Admins?
! Can a higher Root move a lower Root's Sub-CNAs?
! Can a higher Root move a lower Root completely?
! Can a Sub-CNA have two **direct** Roots?
	- (Can a child have two parents)

### Summary List:
- ADP
- CNA
- Root CNA
- Secretariat

## User Role Requirements

### Read Only
Mostly for automation, allows read access to public data for CVE.
Allows tracking of the account to keep a check on the load the account is putting on the services.
Still needs to be tied to an organization for MVP.

### Contributor
A role that allows a user to submit and update a CVE for the CNA.

### Admin
Administers accounts and can participate like a contributor.
Can modify CNA Registry data.

### Root Admin
Can execute the powers of the Root CNA the user belongs to.
Can modify CNA Registry data for the CNA the user belongs to, as well as Sub-CNAs.

### Board Member
Designated by Secretariat, but under a separate Organization

### Secretariat User? "IT Admin"
With MITRE being the Top Level Root and Secretariat, how do we differentiate the administrative intent of a MITRE user in the system? A "Secretariat Admin" or "IT Admin" might be the best answer to understand a user acting as Secretariat vs Root.

## Organization Change Requirements

Organizations merge and split. We'll need to figure out a way to address this.

## Audit Features
Any actions need to be recorded in an audit record.
What action was taken, when, by whom, and for whom.
Details of the action, what object was CRUD.





